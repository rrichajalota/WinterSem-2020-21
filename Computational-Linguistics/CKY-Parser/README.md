## Context-free grammars and CKY parsing
In this code repo, the algorithm [Cocke-Kasami-Younger (CKY)](https://en.wikipedia.org/wiki/CYK_algorithm) has been implemented for the bottom-up parsing of [Context-free Grammars (CFGs)](https://en.wikipedia.org/wiki/Context-free_grammar), 
which is then applied to the word and parsing problem of English. The ingredients are:
- a context-free grammar (CFG)
- test sentences
- a parser (or recognizer)

Given the grammar and the test sentences, the CKY algorithm, when used as a recognizer, tells whether a test sentence is in the language of the CFG or not. 
The CKY parser, which is just an extension of the CKY recognizer, returns the number of parses (or computed parse trees) for each test sentence.  

For more on CFGs, refer to my [notes](https://docs.google.com/document/d/1OwrBo-4IGVGCrK4uAVK-QtZvaNj4xWDlVFov1TtPzvM/edit?usp=sharing), which have been summarized from [Jurafsky & Martin](https://web.stanford.edu/~jurafsky/slp3/12.pdf).

### Project file structure

```
├── cky_parser.py
├── playground.ipynb
├── cfg_conversion_module.py
├── test_cky_parser.py
├── main.py
├── custom_test_sentences.txt
├── atis/
│   ├── atis-grammar-cnf.cfg
│   ├── atis-grammar-original.cfg
│   └── atis-test-sentences.txt
├── results
│   ├── cky_recognizer_atis.txt
│   ├── cky_recognizer_custom_test_file.txt
│   ├── parsing_results_custom_test_file.txt
│   ├── results_with_onlyCount.txt
│   ├── results_with_treeComputation.txt
│   └── viz_parse_trees_top10_atis.txt
│   └── ... 


```
`cky_parser.py` contains the implementation of CKY algorithm as a recognizer and parser.  
`playground.ipynb` contains preliminary code (only meant for playing around).  
`cfg_conversion_module.py` contains code for converting a given CFG grammar into Chmosky-Normal Form (CNF).  
`test_cky_parser` contains test cases to check the functioning of CKY algorithm.
`main.py` is the controller file that runs the entire pipeline. Check out [How to run the scripts?](#how-to-run-the-scripts?).  
`custom_test_sentences.txt` contains some ungrammatical sentences to test the CKY parser.    
`atis/` is the given data folder.   
`results/` In this folder, all the data files generated by the code are stored.   

### Setup Instructions

The code was implemented and tested on: `Python 3.6.9, Ubuntu 18.04`.

Use the following command, preferably in a virtual environment, to run the scripts.  
  ```
  pip -r install requirements.txt
  ```
Or, simply make sure the following libraries are installed:

- nltk==3.5
- pytest==6.2.1


### How to run the scripts?


- In the **default setting**, the **CKY algorithm** runs as a **recognizer** and only tells whether a sentence is in the language of the CFG or not. 
Simply, run `python main.py` and an output file will be generated at:  `results/CKY_result.txt`.  

- To run the **CKY algorithm** as a **parser**, run `python main.py --parser` and an output file will be generated at: `results/CKY_result.txt`.

`results/CKY_result.txt` is the default output-file path and can be changed by additionally providing the `--output_file_path <filename>` argument. 

- Additional arguments that can be passed, are listed below: 
   ```
  --grammar [FILENAME]  # use this option to provide the CKY parser a grammar (file with '.cfg' extension).
  --test [FILENAME]   # use this option to provide a file for testing the CKY parser.
  --output_file_path [FILENAME] # provide filename or filepath for saving the output file.
  --draw_trees  # If specified, all possible parse trees are drawn for the first 10 input sentences.
                 #  Note: this option can only be used if --only_count is False (i.e. not specified).
  --only_count  # If specified, the algorithm simply counts the number of parse trees without actually computing all the parse trees. 
                 # Set this argument for faster computation with --parser.
                 # Note: if --draw_trees is specified, this argument MUST be set to False i.e. must not be specified.
  --help  # to get a preview of the available commands
   ```

#### For testing the CKY algorithm with toy examples  
  Run
  ```
  python test_cky_parser.py
  ```

### Expected Runtime (on ATIS test sentences)

```
CKY Recognizer: 24.63 secs
CKY parser with tree computation: 25.82 secs
CKY parser without computing all the parse trees : 24.32 secs  
```

## A Snippet from parse-trees visualization

```
(2) show the flights .	2

               SIGMA                      
    _____________|_______                  
   |                    JKB               
   |              _______|__________       
   |           NP_NNS               |     
   |       ______|_______           |      
VERB_VB ADJ_AT        NOUN_NNS pt_char_per
   |      |              |          |      
  show   the          flights       .     

               SIGMA                      
    _____________|_______                  
   |                    JKB               
   |              _______|__________       
   |           NP_NNS               |     
   |       ______|_______           |      
VERB_VB AVP_RB        NOUN_NNS pt_char_per
   |      |              |          |      
  show   the          flights       .     
```

Check out the parse trees for other `ATIS test sentences` in `results/viz_parse_trees_top10_atis.txt`.

# TODO : 
- make the custom CFG-conversion module `cfg_conversion_module.py` work. Currently, the generated grammar is in Chomsky normal form but returns incorrect results when tested with ATIS test sentences.
